<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imutabilidade</title>
</head>
<body>
    <script src="../immer.umd.production.min.js"></script>
    
    <script type="module">
        const array1 = [0,1,2,3,4];
        // Imutabilidade quebrada: estamos modificando o array original
        // const array2 = array1; 
        const array2 = [...array1]; // Imutabilidade mantida: criamos um novo array com os mesmos elementos
        console.log(array1 === array2);

        import { createStore } from "./redux.browser.mjs";

        const initialState = {
            nome: "João",
            idade: 30,
        };

        // utilizando o immer
        const obj2 = window.immer.produce(initialState, draft => {
            draft.nome = "Maria";
        });
        console.log(initialState);
        console.log(obj2);


        const reducer = window.immer.produce((state, action) => {
            switch(action.type) {
                case 'MUDAR_NOME':
                    // Imutabilidade quebrada: estamos modificando o estado diretamente
                    // state.nome = action.payload;
                    
                    // Imutabilidade mantida: criamos um novo objeto de estado com as alterações
                    return {
                        ...state,
                        nome: action.payload
                    };
                default:
                    return state;
            }
        }, initialState);

        const store = createStore(reducer, 
            window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__(),
        );

        store.dispatch({ type: 'MUDAR_NOME', payload: 'Maria' });
        store.dispatch({ type: 'MUDAR_NOME', payload: 'Lara' });
        store.dispatch({ type: 'MUDAR_NOME', payload: 'Daniel' });

    </script>
</body>
</html>